# CAPL 编译器测试用例文档

## 概述

本文档描述了 CAPL 编译器项目中包含的各种测试用例，用于验证编译器的功能正确性和稳定性。

## 测试文件结构

```
examples/
├── test.can              # 基础 CAN 消息处理测试
├── example.capl          # 标准 CAPL 语法测试
├── error_test.capl       # 错误处理测试
├── complex_test.capl     # 复杂语法结构测试
├── performance_test.capl # 性能和大代码量测试
└── syntax_error_test.capl # 语法错误检测测试
```

## 测试用例详细说明

### 1. test.can
- **目的**: 测试基础的 CAN 消息处理功能
- **内容**: 包含变量声明、消息处理器、定时器等基本功能
- **验证**: 基本语法解析和代码生成

### 2. example.capl
- **目的**: 测试标准 CAPL 语法特性
- **内容**: 完整的 CAPL 程序结构，包含各种事件处理器
- **验证**: 标准语法的正确性

### 3. error_test.capl
- **目的**: 测试编译器的错误处理能力
- **内容**: 包含各种可能的运行时错误场景
- **验证**: 错误检测和报告机制

### 4. complex_test.capl
- **目的**: 测试复杂语法结构的处理
- **内容**: 
  - 复杂的变量初始化
  - 嵌套的循环和条件语句
  - 函数调用和参数传递
  - 数组操作
  - 多种事件处理器
- **验证**: 复杂语法的解析和代码生成

### 5. performance_test.capl
- **目的**: 测试编译器处理大量代码的性能
- **内容**:
  - 大数组初始化
  - 多个相似的消息处理器
  - 复杂的计算函数
  - 大量的定时器和事件处理
- **验证**: 编译器性能和内存使用

### 6. syntax_error_test.capl
- **目的**: 测试语法错误检测
- **内容**: 故意包含的语法错误
- **验证**: 语法错误检测能力（当前编译器实现较简单，可能不会检测到所有错误）

## 测试执行方式

### 1. 基本测试 (make test)
- 运行所有基础测试用例
- 简洁的输出格式
- 快速验证编译器基本功能

### 2. 详细测试 (make test-verbose)
- 显示完整的编译过程输出
- 适合调试和详细分析
- 包含所有测试用例的详细执行过程

### 3. 自动化测试 (make test-auto)
- 使用专门的测试脚本
- 带颜色的输出和详细统计
- 包含性能测试和时间统计
- 提供完整的测试报告

## 测试覆盖范围

### 功能测试
- ✅ 基本功能（帮助信息、版本信息）
- ✅ 语法检查（-S 选项）
- ✅ 代码编译和生成
- ✅ 文件输出验证
- ✅ 高级选项（AST 输出、词法分析输出）
- ✅ 错误处理（文件不存在、无效选项）

### 性能测试
- ✅ 大文件编译性能
- ✅ 编译时间统计
- ✅ 内存使用验证

### 语法测试
- ✅ 基础语法结构
- ✅ 复杂语法结构
- ✅ 嵌套结构
- ✅ 函数和变量声明
- ✅ 事件处理器

## 测试结果统计

当前测试套件包含 **18 个测试用例**，涵盖：
- 2 个基本功能测试
- 5 个语法检查测试
- 3 个编译测试
- 3 个文件生成验证测试
- 2 个高级选项测试
- 2 个错误处理测试
- 1 个性能测试

## 持续集成

测试脚本 `test_runner.sh` 可以集成到 CI/CD 流程中：
- 返回适当的退出码
- 提供详细的测试报告
- 支持自动化执行
- 包含性能基准测试

## 扩展测试用例

要添加新的测试用例：
1. 在 `examples/` 目录下创建新的测试文件
2. 在 `Makefile` 的测试目标中添加相应的测试命令
3. 在 `test_runner.sh` 中添加对应的测试逻辑
4. 更新本文档说明新测试用例的目的和内容