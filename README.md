# CAPL ç¼–è¯‘å™¨

ä¸€ä¸ªç”¨ C++ å®ç°çš„å¼€æº CAPL (CAN Access Programming Language) ç¼–è¯‘å™¨ï¼Œç”¨äºæ±½è½¦ç”µå­å’Œ CAN æ€»çº¿åº”ç”¨å¼€å‘ã€‚

## é¡¹ç›®æ¦‚è¿°

CAPL æ˜¯ Vector å…¬å¸å¼€å‘çš„ä¸“é—¨ç”¨äº CAN ç½‘ç»œç¼–ç¨‹çš„è„šæœ¬è¯­è¨€ã€‚æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ CAPL ç¼–è¯‘å™¨ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

- **è¯æ³•åˆ†æå™¨ (Lexer)**: å°† CAPL æºä»£ç è½¬æ¢ä¸º Token æµ
- **è¯­æ³•åˆ†æå™¨ (Parser)**: å°† Token æµè½¬æ¢ä¸ºæŠ½è±¡è¯­æ³•æ ‘ (AST)
- **è¯­ä¹‰åˆ†æå™¨ (Semantic Analyzer)**: è¿›è¡Œç±»å‹æ£€æŸ¥å’Œè¯­ä¹‰éªŒè¯
- **ä»£ç ç”Ÿæˆå™¨ (Code Generator)**: å°† AST è½¬æ¢ä¸º C++ ä»£ç 
- **è¿è¡Œæ—¶ç³»ç»Ÿ (Runtime)**: æä¾› CAPL ç¨‹åºè¿è¡Œæ—¶ç¯å¢ƒ
- **ç¬¦å·è¡¨ç®¡ç†**: ç®¡ç†å˜é‡ã€å‡½æ•°å’Œæ¶ˆæ¯ç¬¦å·

## é¡¹ç›®ç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½
- å®Œæ•´çš„ç¼–è¯‘å™¨å·¥å…·é“¾
- æ”¯æŒåŸºæœ¬ CAPL è¯­æ³•è§£æ
- æŠ½è±¡è¯­æ³•æ ‘ç”Ÿæˆå’Œéå†
- ç¬¦å·è¡¨ç®¡ç†ç³»ç»Ÿ
- C++ ä»£ç ç”Ÿæˆ
- å‘½ä»¤è¡Œå·¥å…·æ¥å£
- å¤šç§è¾“å‡ºæ ¼å¼æ”¯æŒ

### ğŸ¯ æ”¯æŒçš„ CAPL è¯­è¨€ç‰¹æ€§
- å˜é‡å£°æ˜å’Œåˆå§‹åŒ–
- æ¶ˆæ¯å®šä¹‰å’Œå¤„ç†
- äº‹ä»¶å¤„ç† (on start, on message, on timer, on key, on stop)
- å‡½æ•°å®šä¹‰å’Œè°ƒç”¨
- åŸºæœ¬æ•°æ®ç±»å‹ (int, float, string)
- æ§åˆ¶æµè¯­å¥ (if, for, while)
- è¡¨è¾¾å¼è®¡ç®—

## ç¼–è¯‘å™¨æ¶æ„

```
CAPL æºç  (.capl/.can) 
    â†“
è¯æ³•åˆ†æå™¨ (Lexer)
    â†“
è¯­æ³•åˆ†æå™¨ (Parser)
    â†“
è¯­ä¹‰åˆ†æå™¨ (Semantic Analyzer)
    â†“
ä»£ç ç”Ÿæˆå™¨ (Code Generator)
    â†“
C++ ä»£ç è¾“å‡º (.cbf)
```

## é¡¹ç›®ç»“æ„

```
capl_compiler/
â”œâ”€â”€ include/              # å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ ast.h            # æŠ½è±¡è¯­æ³•æ ‘å®šä¹‰
â”‚   â”œâ”€â”€ capl_compiler.h  # ç¼–è¯‘å™¨ä¸»ç±»
â”‚   â”œâ”€â”€ symbol_table.h   # ç¬¦å·è¡¨ç®¡ç†
â”‚   â””â”€â”€ token.h          # Token å®šä¹‰
â”œâ”€â”€ src/                 # æºä»£ç æ–‡ä»¶
â”‚   â”œâ”€â”€ ast.cpp          # AST å®ç°
â”‚   â”œâ”€â”€ capl_compiler.cpp # ç¼–è¯‘å™¨å®ç°
â”‚   â”œâ”€â”€ capl_runtime.cpp # è¿è¡Œæ—¶æ”¯æŒ
â”‚   â”œâ”€â”€ code_generator.cpp # ä»£ç ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ lexer.cpp        # è¯æ³•åˆ†æå™¨
â”‚   â”œâ”€â”€ main.cpp         # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ parser.cpp       # è¯­æ³•åˆ†æå™¨
â”‚   â”œâ”€â”€ semantic_analyzer.cpp # è¯­ä¹‰åˆ†æå™¨
â”‚   â”œâ”€â”€ symbol_table.cpp # ç¬¦å·è¡¨å®ç°
â”‚   â””â”€â”€ token.cpp        # Token å®ç°
â”œâ”€â”€ examples/            # ç¤ºä¾‹å’Œæµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ README.md        # ç¤ºä¾‹è¯´æ˜
â”‚   â”œâ”€â”€ test.can         # åŸºç¡€æµ‹è¯•ç¨‹åº
â”‚   â”œâ”€â”€ example.capl     # å®Œæ•´ç¤ºä¾‹ç¨‹åº
â”‚   â””â”€â”€ error_test.capl  # é”™è¯¯æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ bin/                 # å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ build/               # æ„å»ºæ–‡ä»¶
â”œâ”€â”€ Makefile            # Make æ„å»ºé…ç½®
â””â”€â”€ README.md           # é¡¹ç›®æ–‡æ¡£
```

## æ„å»ºè¯´æ˜

### ç³»ç»Ÿè¦æ±‚
- C++17 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ (GCC 7+, Clang 5+, MSVC 2017+)
- Make æ„å»ºå·¥å…·
- æ”¯æŒçš„æ“ä½œç³»ç»Ÿ: Linux, macOS, Windows (ä½¿ç”¨ MinGW æˆ– MSYS2)

### æ„å»ºæ­¥éª¤
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd capl_compiler

# ç¼–è¯‘é¡¹ç›®
make

# æ¸…ç†æ„å»ºæ–‡ä»¶
make clean

# è¿è¡Œæµ‹è¯•
make test

# è¿è¡Œæ¼”ç¤º
make demo
```

### å…¶ä»– Make ç›®æ ‡
```bash
# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
make help

# æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
make debug

# å®‰è£…åˆ°ç³»ç»Ÿ (éœ€è¦ sudo)
make install

# ä»ç³»ç»Ÿå¸è½½ (éœ€è¦ sudo)
make uninstall
```

## ä½¿ç”¨è¯´æ˜

### åŸºæœ¬ç”¨æ³•
```bash
# ç¼–è¯‘ CAPL æ–‡ä»¶
./bin/capl_compiler input.capl

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶
./bin/capl_compiler -o output.cbf input.capl

# ä»…è¿›è¡Œè¯­æ³•æ£€æŸ¥
./bin/capl_compiler -S input.capl

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
./bin/capl_compiler --help

# æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
./bin/capl_compiler --version
```

### é«˜çº§é€‰é¡¹
```bash
# è¾“å‡ºæŠ½è±¡è¯­æ³•æ ‘
./bin/capl_compiler --ast-dump input.capl

# è¾“å‡ºè¯æ³•åˆ†æç»“æœ
./bin/capl_compiler --tokens-dump input.capl

# å¯ç”¨è°ƒè¯•ä¿¡æ¯
./bin/capl_compiler -g input.capl

# è®¾ç½®ä¼˜åŒ–çº§åˆ«
./bin/capl_compiler -O2 input.capl

# æ·»åŠ åŒ…å«ç›®å½•
./bin/capl_compiler -I./include input.capl
```

### ç¤ºä¾‹ç¨‹åº
é¡¹ç›®æä¾›äº†å¤šä¸ªç¤ºä¾‹ç¨‹åºï¼Œä½äº `examples/` ç›®å½•ï¼š

```bash
# ç¼–è¯‘åŸºç¡€ç¤ºä¾‹
./bin/capl_compiler examples/test.can

# ç¼–è¯‘å®Œæ•´ç¤ºä¾‹
./bin/capl_compiler examples/example.capl

# æµ‹è¯•é”™è¯¯å¤„ç†
./bin/capl_compiler examples/error_test.capl
```

## æ”¯æŒçš„ CAPL è¯­æ³•ç¤ºä¾‹

### å˜é‡å£°æ˜
```capl
variables {
    int counter = 0;
    float temperature = 25.5;
    message 0x123 TestMessage;
}
```

### äº‹ä»¶å¤„ç†
```capl
on start {
    write("ç¨‹åºå¯åŠ¨");
}

on message 0x123 {
    write("æ”¶åˆ°æ¶ˆæ¯: ID = 0x%X", this.id);
}

on timer myTimer {
    write("å®šæ—¶å™¨è§¦å‘");
}

on key 'a' {
    write("æŒ‰é”® 'a' è¢«æŒ‰ä¸‹");
}
```

### å‡½æ•°å®šä¹‰
```capl
void sendMessage(int id, int data) {
    TestMessage.id = id;
    TestMessage.byte(0) = data;
    output(TestMessage);
}
```

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ç›¸åº”çš„å¤´æ–‡ä»¶ä¸­å£°æ˜æ¥å£
2. åœ¨å¯¹åº”çš„æºæ–‡ä»¶ä¸­å®ç°åŠŸèƒ½
3. æ·»åŠ å•å…ƒæµ‹è¯•
4. æ›´æ–°æ–‡æ¡£

### ä»£ç é£æ ¼
- ä½¿ç”¨ 4 ä¸ªç©ºæ ¼ç¼©è¿›
- å‡½æ•°å’Œå˜é‡ä½¿ç”¨ camelCase å‘½å
- ç±»åä½¿ç”¨ PascalCase å‘½å
- å¸¸é‡ä½¿ç”¨ UPPER_CASE å‘½å

### è°ƒè¯•æŠ€å·§
```bash
# ä½¿ç”¨è°ƒè¯•æ¨¡å¼ç¼–è¯‘
make DEBUG=1

# æŸ¥çœ‹è¯¦ç»†è¾“å‡º
./bin/capl_compiler -v input.capl

# ä½¿ç”¨ GDB è°ƒè¯•
gdb ./bin/capl_compiler
```

## é™åˆ¶å’Œå·²çŸ¥é—®é¢˜

### å½“å‰é™åˆ¶
- éƒ¨åˆ†é«˜çº§ CAPL ç‰¹æ€§å°šæœªå®ç°
- é”™è¯¯æŠ¥å‘Šå¯èƒ½ä¸å¤Ÿè¯¦ç»†
- æ€§èƒ½ä¼˜åŒ–æœ‰å¾…æ”¹è¿›

### å·²çŸ¥é—®é¢˜
- å¤æ‚è¡¨è¾¾å¼è§£æå¯èƒ½å­˜åœ¨é—®é¢˜
- æŸäº›è¾¹ç•Œæƒ…å†µå¤„ç†ä¸å®Œå–„
- å†…å­˜ç®¡ç†éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–

## æŠ€æœ¯æŒ‘æˆ˜

1. **è¯­æ³•å¤æ‚æ€§**: CAPL è¯­æ³•ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ä»”ç»†åˆ†æ
2. **è¿è¡Œæ—¶ç¯å¢ƒ**: éœ€è¦å®ç°äº‹ä»¶é©±åŠ¨çš„è¿è¡Œæ—¶ç¯å¢ƒ
3. **ç¡¬ä»¶æ¥å£**: éœ€è¦æ”¯æŒå¤šç§ CAN ç¡¬ä»¶æ¥å£
4. **å…¼å®¹æ€§**: ç¡®ä¿ä¸ç°æœ‰ CAPL ä»£ç çš„å…¼å®¹æ€§

## è´¡çŒ®æŒ‡å—

æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯·å‚è€ƒä»¥ä¸‹æ–¹å¼å‚ä¸ï¼š

1. **ä»£ç è´¡çŒ®**: æäº¤ Pull Request
2. **é—®é¢˜æŠ¥å‘Š**: åœ¨ Issues ä¸­æŠ¥å‘Š bug
3. **åŠŸèƒ½å»ºè®®**: æå‡ºæ–°åŠŸèƒ½éœ€æ±‚
4. **æ–‡æ¡£æ”¹è¿›**: å®Œå–„é¡¹ç›®æ–‡æ¡£

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œç¡®ä¿å¼€æºç¤¾åŒºå¯ä»¥è‡ªç”±ä½¿ç”¨å’Œä¿®æ”¹ã€‚

## è”ç³»æ–¹å¼

- é¡¹ç›®ç»´æŠ¤è€…: [æ‚¨çš„å§“å]
- é‚®ç®±: [æ‚¨çš„é‚®ç®±]
- è®¨è®ºç¾¤ç»„: [åˆ›å»ºè®¨è®ºç¾¤ç»„]

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä»åœ¨è§„åˆ’é˜¶æ®µï¼Œæ¬¢è¿æœ‰å…´è¶£çš„å¼€å‘è€…åŠ å…¥è®¨è®ºå’Œè´¡çŒ®ã€‚